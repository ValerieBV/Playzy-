<script>
document.addEventListener('DOMContentLoaded', function () {
  // Countdown 48h + phát sự kiện khi kết thúc (đã có ở block trên)
});
</script>
{% extends "base.html" %}
{% load static humanize %}

{% block title %}Trang chủ - Playzy{% endblock %}
{% block content %}
<!-- Carousel Banner (Bootstrap) -->
<div id="homeBanner" class="carousel slide" data-bs-ride="carousel" style="max-width:1200px;margin:130px auto 16px auto;">
	<div class="carousel-indicators">
		<button type="button" data-bs-target="#homeBanner" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
		<button type="button" data-bs-target="#homeBanner" data-bs-slide-to="1" aria-label="Slide 2"></button>
		<button type="button" data-bs-target="#homeBanner" data-bs-slide-to="2" aria-label="Slide 3"></button>
	</div>
	<div class="carousel-inner">
		<!-- Ảnh nội bộ dự án -->
		<div class="carousel-item active">
			<img src="{% static 'Playzy/images/v110_3206.png' %}" class="d-block w-100" alt="Playzy Banner 1" style="object-fit:cover;max-height:620px;">
		</div>
		<div class="carousel-item active">
			<img src="{% static 'Playzy/images/banner/banner2.png' %}" class="d-block w-100" alt="Playzy Banner 1" style="object-fit:cover;max-height:620px;">
		</div>
		<div class="carousel-item active">
			<img src="{% static 'Playzy/images/banner/banner3.png' %}" class="d-block w-100" alt="Playzy Banner 1" style="object-fit:cover;max-height:620px;">
		</div>
	</div>
	<button class="carousel-control-prev" type="button" data-bs-target="#homeBanner" data-bs-slide="prev">
		<span class="carousel-control-prev-icon" aria-hidden="true"></span>
		<span class="visually-hidden">Previous</span>
	</button>
	<button class="carousel-control-next" type="button" data-bs-target="#homeBanner" data-bs-slide="next">
		<span class="carousel-control-next-icon" aria-hidden="true"></span>
		<span class="visually-hidden">Next</span>
	</button>
</div>
<style>
.pz-new-products{max-width:1200px;margin:24px auto 32px auto;padding:0 16px}
.pz-new-products-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.pz-new-products-title{font-weight:800;color:#e65c00;font-size:22px}
.pz-new-products-more{color:#1E90FF;text-decoration:none;font-weight:700}
.pz-product-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.pz-card{background:#fff;border:1px solid #ffd8b0;border-radius:16px;padding:12px;text-align:center;box-shadow:0 4px 10px rgba(0,0,0,.05)}
.pz-card img{width:100%;height:180px;object-fit:cover;border-radius:12px}
.pz-card-name{margin-top:10px;font-weight:700;color:#4b2c20;min-height:44px}
.pz-card-price{color:#e65c00;font-weight:800;margin:6px 0}
.pz-card a.btn{display:inline-block;background:#e65c00;color:#fff !important;padding:8px 14px;border-radius:999px;text-decoration:none;font-weight:800}
.pz-card a.btn:hover{background:#cc5200}
.news-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:14px}
.news-card{background:#fff;border-radius:16px;padding:12px;text-align:left;box-shadow:0 4px 10px rgba(0,0,0,.04);height:100%;display:flex;flex-direction:column;gap:8px}
.news-card img{width:100%;height:140px;object-fit:cover;border-radius:12px}
.news-card-title{font-weight:700;color:#4b2c20;font-size:16px;line-height:1.3}
.news-card-desc{font-size:14px;color:#5f5f5f;line-height:1.4;flex:1}
.news-card .btn{align-self:flex-start;background:#fff;color:#E96607 !important;border:1px solid #E96607;padding:6px 14px;border-radius:999px;font-weight:700}
.news-card .btn:hover{background:#E96607;color:#fff !important}
@media(max-width:992px){.pz-product-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:576px){.pz-product-grid{grid-template-columns:1fr}}
@media(max-width:1200px){.news-grid{grid-template-columns:repeat(3,1fr)}}
@media(max-width:768px){.news-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:576px){.news-grid{grid-template-columns:1fr}}
</style>
<script>
// Countdown 48h + phát sự kiện khi kết thúc (chạy sau khi DOM sẵn sàng)
document.addEventListener('DOMContentLoaded', function () {
  const d = document.getElementById("vc-day");
  const h = document.getElementById("vc-hour");
  const m = document.getElementById("vc-min");
  const s = document.getElementById("vc-sec");
  const title = document.getElementById("voucher-title") || document.querySelector('[style*="NHÂN NGÀY 20.10"]');
  if (!d || !h || !m || !s) return;
  const target = Date.now() + 48 * 60 * 60 * 1000;
  let ended = false;
  function tick() {
    let diff = target - Date.now();
    if (diff <= 0) {
      diff = 0;
      if (!ended) {
        ended = true;
        document.dispatchEvent(new CustomEvent('voucherCountdownEnd'));
        if (title) { title.textContent = "Chương trình voucher đã kết thúc"; }
      }
    }
    const dd = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hh = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const mm = Math.floor((diff / (1000 * 60)) % 60);
    const ss = Math.floor((diff / 1000) % 60);
    d.textContent = String(dd).padStart(2, "0");
    h.textContent = String(hh).padStart(2, "0");
    m.textContent = String(mm).padStart(2, "0");
    s.textContent = String(ss).padStart(2, "0");
  }
  tick();
  setInterval(tick, 1000);
});
</script>


<link rel="stylesheet" href="{% static 'Playzy/css/main.css' %}">

<!-- SECTION: SẢN PHẨM MỚI VỀ -->
{% if latest_products %}
<!-- VOUCHER FRAME ABOVE PRODUCT SECTION -->
<section style="max-width:1200px;margin:10px auto 4px auto;padding:0 16px;">
  <div style="background:#E8F2FF;border-radius:20px;padding:16px 22px;text-align:center;">
      <div id="voucher-title" class="fw-bold mb-2" style="color:#1E90FF;">
        MUA NGAY ĐỂ NHẬN VOUCHER LÊN ĐẾN <span style="color:#FF6F00;">40%</span> NHÂN NGÀY 20.10
      </div>
      <div class="d-flex align-items-center justify-content-center gap-3" style="font-weight:800;color:#1E90FF;">
        <span id="vc-day" class="badge bg-white text-primary border" style="min-width:48px;height:42px;font-size:18px;display:inline-flex;align-items:center;justify-content:center;">00</span>
        <span style="color:#000;font-size:22px;">:</span>
        <span id="vc-hour" class="badge bg-white text-primary border" style="min-width:48px;height:42px;font-size:18px;display:inline-flex;align-items:center;justify-content:center;">00</span>
        <span style="color:#000;font-size:22px;">:</span>
        <span id="vc-min" class="badge bg-white text-primary border" style="min-width:48px;height:42px;font-size:18px;display:inline-flex;align-items:center;justify-content:center;">00</span>
        <span style="color:#000;font-size:22px;">:</span>
        <span id="vc-sec" class="badge bg-white text-primary border" style="min-width:48px;height:42px;font-size:18px;display:inline-flex;align-items:center;justify-content:center;">00</span>
      </div>
  </div>
 </section>

<section style="max-width:1200px;margin:18px auto 0 auto;padding:0 16px;">
	<div style="background:#E96607;border-radius:40px;padding:18px 20px;">
		<div class="d-flex align-items-center justify-content-between mb-2">
			<h5 class="m-0" style="font-weight:800;color:#FAF3EA;">SẢN PHẨM MỚI VỀ</h5>
			<a id="seeMoreProducts" href="{% url 'Sanpham:trang_danh_muc' %}?sort=newest" class="fw-bold" style="color:#FAF3EA;text-decoration:none;">Xem thêm</a>
		</div>
		<div style="display:grid;grid-template-columns:repeat(5,1fr);gap:14px;">
			{% for sp in latest_products %}
			<div class="pz-card">
				<a href="{% url 'Sanpham:chi_tiet_san_pham' sp.ma_sp %}">
					{% if sp.anh_dai_dien %}
						<img src="{{ sp.anh_dai_dien.url }}" alt="{{ sp.ten_sp }}">
					{% else %}
						<img src="{% static 'images/placeholder.png' %}" alt="{{ sp.ten_sp }}">
					{% endif %}
				</a>
				<div class="pz-card-name" style="color:#4b2c20;">{{ sp.ten_sp }}</div>
				<div class="pz-card-price">
					{% if sp.ty_le_giam_gia and sp.ty_le_giam_gia > 0 %}
						<span style="text-decoration:line-through;color:#888;font-weight:700;margin-right:6px">{{ sp.gia_goc|floatformat:0|intcomma }}đ</span>
					{% endif %}
					<span style="color:#E65C00;">{{ sp.gia_da_giam|floatformat:0|intcomma }}đ</span>
				</div>
				<a class="btn" href="{% url 'Sanpham:chi_tiet_san_pham' sp.ma_sp %}">Xem chi tiết</a>
			</div>
			{% endfor %}
		</div>
	</div>
</section>
{% endif %}

<!-- SECTION: TIN TỨC -->
<section style="max-width:1200px;margin:18px auto 30px auto;padding:0 16px;">
	<div style="background:#FFE5CC;border-radius:40px;padding:18px 20px;">
		<div class="d-flex align-items-center justify-content-between mb-2">
			<h5 class="m-0" style="font-weight:800;color:#E65C00;">TIN TỨC</h5>
			<a href="{% url 'Tintuc:trang_tintuc' %}" class="fw-bold" style="color:#E65C00;text-decoration:none;">Xem tất cả</a>
		</div>
		<div class="news-grid">
			{% for post in latest_posts %}
			<div class="news-card">
				{% if post.anh_dai_dien %}
				<a href="{% url 'Tintuc:chi_tiet' post.pk %}">
					<img src="{{ post.anh_dai_dien.url }}" alt="{{ post.tieu_de }}">
				</a>
				{% endif %}
				<a class="news-card-title" href="{% url 'Tintuc:chi_tiet' post.pk %}">{{ post.tieu_de }}</a>
				<p class="news-card-desc">{{ post.noi_dung|striptags|truncatechars:140 }}</p>
				<a class="btn" href="{% url 'Tintuc:chi_tiet' post.pk %}">Đọc bài viết</a>
			</div>
			{% empty %}
			<div class="text-white">Chưa có bài viết.</div>
			{% endfor %}
		</div>
	</div>
</section>
{% endblock %}
